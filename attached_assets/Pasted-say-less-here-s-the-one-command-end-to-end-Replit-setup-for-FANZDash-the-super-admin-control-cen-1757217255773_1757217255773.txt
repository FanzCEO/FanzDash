say less â€” hereâ€™s the one-command, end-to-end Replit setup for FANZDash (the super-admin control center for the whole FUN empire: compliance, moderation, payouts, ads, security, feature flags, kill-switches, org + tenancy, and cross-platform controls). It auto-verifies there are no missing pages, dead links, schema drift, or API/UI gaps before it prints a neon READY FOR PROD banner.

â¸»

ğŸ”§ One command to wire everything

Run this in the Replit shell at the repo root:

npm run prep:prod:fanzdash

That command: builds FE+BE, runs migrations + seeds, generates OpenAPI + typed client, checks APIâ†”UI parity, validates schema drift, verifies all webhooks (KYC, payouts, ads), runs unit + E2E tests, crawls pages for 404s, and prints READY FOR PROD if green.

â¸»

1) Root package.json (scripts)

Add/merge:

{
  "name": "fanzdash-monorepo",
  "private": true,
  "workspaces": ["app/frontend", "app/backend", "packages/*", "scripts"],
  "scripts": {
    "postinstall": "npm run -w app/frontend install && npm run -w app/backend install",
    "build": "npm run -w app/backend build && npm run -w app/frontend build",
    "migrate": "npm run -w app/backend migrate",
    "seed": "npm run -w app/backend seed",
    "test": "npm -w app/backend run test && npm -w app/frontend run test",
    "openapi": "npm -w app/backend run openapi && npm -w app/frontend run types:pull",
    "verify:contracts": "npm -w app/backend run verify:contracts",
    "verify:drift": "npm -w app/backend run verify:drift",
    "verify:webhooks": "npm -w app/backend run verify:webhooks",
    "verify:health": "npm -w app/backend run verify:health",
    "e2e": "npm -w app/backend run e2e",
    "crawl": "npm -w app/frontend run crawl",
    "verify:all": "npm run build && npm run migrate && npm run seed && npm run test && npm run openapi && npm run verify:contracts && npm run verify:drift && npm run verify:webhooks && npm run verify:health && npm run e2e && npm run crawl",
    "prep:prod:fanzdash": "node scripts/env-gate.cjs && npm run verify:all && node scripts/print-ready.cjs"
  },
  "devDependencies": {
    "concurrently": "^9.0.0"
  }
}


â¸»

2) Backend scripts (app/backend/package.json)

{
  "name": "fanzdash-backend",
  "type": "module",
  "scripts": {
    "dev": "tsx src/index.ts",
    "build": "tsc -p tsconfig.json",
    "start": "node dist/index.js",
    "migrate": "drizzle-kit migrate",
    "studio": "drizzle-kit studio",
    "seed": "tsx scripts/seed.ts",
    "test": "vitest run",
    "openapi": "tsx scripts/generate-openapi.ts > public/docs/openapi.json",
    "verify:contracts": "tsx scripts/verify-contracts.ts",
    "verify:drift": "tsx scripts/verify-drift.ts",
    "verify:webhooks": "tsx scripts/verify-webhooks.ts",
    "verify:health": "tsx scripts/verify-health.ts",
    "e2e": "playwright test"
  }
}

Backend helper stubs you must include

Create minimal but working versions of:
	â€¢	scripts/generate-openapi.ts â€” emit OpenAPI from shared Zod schemas.
	â€¢	scripts/verify-contracts.ts â€” scan Express routes vs OpenAPI; ensure every endpoint has a handler + at least one typed client usage (or @serverOnly).
	â€¢	scripts/verify-drift.ts â€” drizzle introspect dry-run vs migrations.
	â€¢	scripts/verify-webhooks.ts â€” HMAC/signature checks and handler presence for:
	â€¢	/webhooks/verifymy (KYC)
	â€¢	/webhooks/payouts (provider events)
	â€¢	/webhooks/ads (ad review/serve events)
	â€¢	scripts/verify-health.ts â€” DB ping, S3 presign, JWT sign/verify, WS echo, policy engine load test.
	â€¢	scripts/seed.ts â€” org + tenancy seed, 1 superadmin, 2 reviewers, 1 finance admin, sample policies/flags, sample ads, sample payout requests, sample compliance docs.

â¸»

3) Frontend scripts (app/frontend/package.json)

{
  "name": "fanzdash-frontend",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build && node scripts/routes-manifest.cjs",
    "preview": "vite preview",
    "test": "vitest run",
    "routes:manifest": "node scripts/routes-manifest.cjs",
    "crawl": "node scripts/crawlLinks.cjs",
    "types:pull": "node scripts/pull-openapi-client.cjs"
  }
}

Frontend helper stubs (create now):
	â€¢	scripts/routes-manifest.cjs â€” emit dist/routeManifest.json with { path, component, requiresAuth, roleGuard }, and import each route component once to catch broken imports.
	â€¢	scripts/crawlLinks.cjs â€” start preview, crawl from /, visit all links with Playwright headless, assert no 404/console errors, write dist/link-report.json.
	â€¢	scripts/pull-openapi-client.cjs â€” regenerate a typed API client from /docs/openapi.json.

â¸»

4) ENV gate + READY banner (root /scripts)

Create /scripts/env-gate.cjs:

const required = [
  'DATABASE_URL',
  'S3_ENDPOINT','S3_REGION','S3_BUCKET','S3_ACCESS_KEY_ID','S3_SECRET_ACCESS_KEY',
  'JWT_ISS','JWT_AUD','JWT_SECRET','JWT_ACCESS_TTL','JWT_REFRESH_TTL',
  'VERIFYMY_API_URL','VERIFYMY_API_KEY',
  'WEB_APP_URL','API_URL','NODE_ENV',
  // Security / Policy
  'OPA_POLICIES_BUCKET', 'OPA_BOOT_POLICY_PATH',
  'SIEM_ENDPOINT', 'SIEM_API_KEY',
  // Payouts / Finance
  'PAYOUTS_PROVIDER', 'PAYOUTS_WEBHOOK_SECRET',
  // Ads
  'ADS_WEBHOOK_SECRET',
  // Multi-tenant / SSO
  'TENANCY_MODE',             // single | multi
  'SSO_ISSUER', 'SSO_JWKS_URL'
];
const missing = required.filter(k => !process.env[k]);
if (missing.length) {
  console.error('âŒ Missing required env vars:\n' + missing.map(k => ` - ${k}`).join('\n'));
  process.exit(1);
}
console.log('âœ… ENV check passed');

Create /scripts/print-ready.cjs:

console.log(`
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•  
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•
FANZDash: ALL CHECKS PASSED â€” READY FOR PROD âœ¨
`);


â¸»

5) Required ENV (set in Replit â†’ Tools â†’ Secrets)

# Core
DATABASE_URL=postgres://...
S3_ENDPOINT=https://s3.us-east-1.wasabisys.com
S3_REGION=us-east-1
S3_BUCKET=fun-fanzdash
S3_ACCESS_KEY_ID=...
S3_SECRET_ACCESS_KEY=...

# Auth
JWT_ISS=fun.app
JWT_AUD=fun.admins
JWT_SECRET=use-a-64-byte-random-string
JWT_ACCESS_TTL=900
JWT_REFRESH_TTL=2592000

# Compliance
VERIFYMY_API_URL=...
VERIFYMY_API_KEY=...

# Security / Policy / SIEM
OPA_POLICIES_BUCKET=s3://fun-policies
OPA_BOOT_POLICY_PATH=fanzdash.rego
SIEM_ENDPOINT=https://siem.example.com/ingest
SIEM_API_KEY=...

# Payouts / Finance
PAYOUTS_PROVIDER=mock       # mock | ach | crypto | adultprocX
PAYOUTS_WEBHOOK_SECRET=change-me

# Ads Moderation / Serving
ADS_WEBHOOK_SECRET=change-me

# Tenancy & SSO
TENANCY_MODE=multi          # single | multi
SSO_ISSUER=https://sso.fun
SSO_JWKS_URL=https://sso.fun/.well-known/jwks.json

# App URLs
WEB_APP_URL=http://localhost:3000
API_URL=http://localhost:5173/api
NODE_ENV=production


â¸»

6) Route map (super-admin: must exist & render)

Frontend (React 18 + TS + Vite + Tailwind + Radix/shadcn + TanStack Query + Wouter)
	â€¢	/auth/login /auth/otp /auth/reset
	â€¢	/ (Global Overview: KPI tiles + alerts)
	â€¢	/org/tenants (list/create tenants; switch context; SSO domain mapping)
	â€¢	/users (directory; roles; invite; impersonate with audit trail)
	â€¢	/moderation/queue (submissions across platforms; approve/reject; notes; evidence)
	â€¢	/compliance/kyc (VerifyMy status board; drilldown)
	â€¢	/compliance/2257 (records vault; custodians)
	â€¢	/payouts (requests; provider status; export CSV)
	â€¢	/ads/review (creatives, formats, targeting; approval pipeline)
	â€¢	/ads/inventory (placements across FanzRoulette/FanzTube/etc.; pricing/caps)
	â€¢	/catalog/global (FanzCommerce global catalog controls; flags, removals)
	â€¢	/security/events (SIEM feed; filters; IP/UA; device map)
	â€¢	/security/policies (OPA policies editor + publish; dry-run simulator)
	â€¢	/feature-flags (toggle per tenant/platform; rollout %; kill-switches)
	â€¢	/integrations (webhooks, API keys, S3, LiveKit, mail, SMS)
	â€¢	/settings/billing (fees defaults; tax stubs; invoice export)
	â€¢	/settings/branding (theme tokens; logos; legal footers)
	â€¢	/system (diagnostics + manifests + last crawl/report)
	â€¢	/* 404

API (Express + TS + Zod + ws)
	â€¢	/api/auth/*, /api/users/*, /api/tenants/*
	â€¢	/api/moderation/* (queue, decisions, audit)
	â€¢	/api/compliance/* (kyc, 2257)
	â€¢	/api/payouts/*
	â€¢	/api/ads/* (review, inventory, serve policies)
	â€¢	/api/catalog/* (global controls)
	â€¢	/api/security/* (events, IP bans, device revocation, session invalidation)
	â€¢	/api/policies/* (OPA bundles CRUD, publish)
	â€¢	/api/flags/* (feature flags, rollouts)
	â€¢	/api/integrations/* (webhooks, api keys, providers)
	â€¢	/webhooks/verifymy  (signature-verified)
	â€¢	/webhooks/payouts   (HMAC with PAYOUTS_WEBHOOK_SECRET)
	â€¢	/webhooks/ads       (HMAC with ADS_WEBHOOK_SECRET)
	â€¢	/docs + /docs/openapi.json
	â€¢	/healthz /version /introspect/*
	â€¢	/ws (admin notifications channel)

â¸»

7) Data model (Drizzle + migrations + seeds)

Core tables (with indexes):
	â€¢	tenants (slug, name, sso_domain, status)
	â€¢	users (id, email, password_hash, global_role superadmin/admin/reviewer/finance/security, status)
	â€¢	memberships (user_id, tenant_id, role, scopes_json)
	â€¢	sessions (user_id, refresh_token_hash, ip, ua, device_id, expires_at)
	â€¢	audit_logs (actor_id, tenant_id nullable, action, target_type, target_id, diff_json, created_at)
	â€¢	kyc_verifications (user_id, provider, status, external_id, data_json)
	â€¢	records_2257 (user_id, doc_type, s3_key, checksum, created_at)
	â€¢	moderation_queue (platform, target_type, target_id, status, reviewer_id, reason, evidence_json, decided_at)
	â€¢	payout_requests (user_id, amount_cents, currency, status, provider_ref)
	â€¢	ads_creatives (id, advertiser_id, type, meta_json, status)
	â€¢	ads_placements (platform, slot, caps_json, rate_card_json)
	â€¢	global_flags (flag_key, value_json, tenant_id nullable, platform nullable, rollout_percent)
	â€¢	opa_policies (id, name, version, rego_s3_key, active, notes)
	â€¢	security_events (tenant_id nullable, kind, ip, ua, geo_json, severity, meta_json, created_at)
	â€¢	webhooks (tenant_id nullable, url, secret, events_json, status)
	â€¢	api_keys (tenant_id nullable, key_hash, scopes, last_used_at)
	â€¢	notifications (user_id, kind, payload_json, read_at)

Seeds (scripts/seed.ts):
	â€¢	1 superadmin@fanzdash.app / Super!234
	â€¢	2 tenants (boyfanz, fanzcommerce)
	â€¢	2 reviewers (moderation), 1 finance admin, 1 security admin
	â€¢	sample policies (adult-media-default.rego), sample ads + placements
	â€¢	sample payout reqs, KYC entries, 2257 docs
	â€¢	feature flags with some enabled/disabled

â¸»

8) Security & control flows (built-ins)
	â€¢	Impersonation (with audit): superadmin can impersonate any user across tenants; action logged with reason + timebox.
	â€¢	Kill-switches: feature flags allow immediate disable of modules (e.g., uploads, payouts, ads serve) globally or per tenant.
	â€¢	Policy engine: OPA-style evaluation: request context â†’ decision (allow/deny/flag). Policies stored in S3; boot policy path from ENV.
	â€¢	Session invalidation: revoke device/session, force logout everywhere.
	â€¢	SIEM forwarder: security_events streamed to SIEM_ENDPOINT with API key; retry with backoff.
	â€¢	Rate limits: sensitive endpoints (moderation decisions, payouts, policies publish, impersonation) rate-limited + require step-up OTP.

â¸»

9) Diagnostics & completeness (auto)
	â€¢	Route Manifest: FE emits routeManifest.json; /system shows counts + last check render.
	â€¢	Link Crawler: visits all links starting at /; writes link-report.json (no 404/console errors).
	â€¢	APIâ†”UI Parity: every OpenAPI endpoint has a server handler + typed client usage (or @serverOnly).
	â€¢	Schema Drift: drizzle introspect vs migrations; fail on drift.
	â€¢	Webhook Verifier: HMAC tests for /webhooks/verifymy, /webhooks/payouts, /webhooks/ads.
	â€¢	Health: DB, S3, JWT, WS echo, OPA policy load, SIEM send dry-run.

â¸»

10) Tests (must pass for READY banner)

Unit (Vitest)
	â€¢	policy evaluation (allow/deny/flag)
	â€¢	moderation decision writes audit_logs + updates target
	â€¢	payouts webhook signature verify + state transitions
	â€¢	ads creative approval pipeline + placement caps
	â€¢	feature flag rollout math (global vs tenant vs platform)
	â€¢	impersonation guard + audit trail

E2E (Playwright)
	1.	Superadmin logs in â†’ switches tenant â†’ impersonates a reviewer â†’ processes moderation queue â†’ returns to superadmin.
	2.	Finance admin reviews payout requests â†’ marks paid (mock) â†’ CSV export.
	3.	Security admin toggles kill-switch for uploads â†’ verify affected platform shows disabled state via /system probe.
	4.	Policy admin publishes new OPA policy â†’ dry-run sim passes â†’ policy active.
	5.	/system shows all checks âœ…; link-report.json zero failures.

â¸»

11) Minimal /system JSON (backend)

Return something like:

{
  "db":"ok","s3":"ok","jwt":"ok","wsEcho":"ok",
  "kycSignatureTest":"ok","payoutsSignatureTest":"ok","adsSignatureTest":"ok",
  "opaPolicyLoad":"ok","siemDryRun":"ok",
  "openapiEndpoints": 0, "serverRoutes": 0, "uiRoutes": 0,
  "lastCrawl": {"urls": 0, "failures": 0}
}

(Replace zeros with live counts.)

â¸»

12) Tech stack (Replit-friendly)
	â€¢	Frontend: React 18 + TS + Vite, Tailwind, Radix/shadcn/ui, TanStack Query, Wouter
	â€¢	Backend: Node/Express + TS, Zod, Drizzle ORM + drizzle-kit, ws for realtime
	â€¢	Storage: S3-compatible (@aws-sdk/client-s3)
	â€¢	Docs: OpenAPI (Zod â†’ JSON) served at /docs
	â€¢	Tests: Vitest (unit), Playwright (E2E)
	â€¢	Lint/Format: ESLint + Prettier

â¸»

13) Seed credentials (in scripts/seed.ts)
	â€¢	Superadmin: superadmin@fanzdash.app / Super!234
	â€¢	Reviewer: reviewer@fanzdash.app / Reviewer!234
	â€¢	Finance: finance@fanzdash.app / Finance!234
	â€¢	Security: security@fanzdash.app / Security!234

â¸»

Run it
	1.	Add these scripts/files.
	2.	Set the ENV secrets.
	3.	In Replit shell:

npm run prep:prod:fanzdash

If everythingâ€™s wired and passing, youâ€™ll see the neon READY FOR PROD crown. ğŸŸ¡ğŸŒ Go run the whole empire from one dashboard.